<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>My Anime List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .anime-table {
            width: 100%;
            border-collapse: collapse;
        }
        .anime-table th, .anime-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .anime-table th {
            background-color: #f4f4f4;
        }
        .status-check {
            text-align: center;
        }
        .status-check input {
            pointer-events: none;
        }
  /* Table styling */
  table {
    width: 100%;
    border-collapse: collapse;
  }
  
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
  }

  /* Make the header sticky */
  thead th {
    position: sticky;
    top: 0;
    background-color: #f2f2f2;
    z-index: 2;
  }
  
  /* Optional: Add a shadow effect for better visibility */
  thead th::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    height: 3px;
    background-color: #ddd;
    z-index: 1;
  }

  /* Table row hover effect */
  tr:hover {
    background-color: #f5f5f5;
  }

</style>

</head>
<body>

<h1>My Anime List</h1>

<table>
  <thead>
    <tr>
      <th>Anime Name</th>
      <th>Status</th>
      <th>Episodes</th>
      <th>Watching</th>
      <th>Completed</th>
      <th>Paused</th>
      <th>Dropped</th>
      <th>Planning</th>
    </tr>
  </thead>
  <tbody id="anime-list">
    <!-- Anime rows will be dynamically inserted here -->
  </tbody>
</table>

<script>
    async function fetchAnimeList() {
        const query = `
  query ($userId: Int) {
    MediaListCollection(userId: $userId, type: ANIME) {
      lists {
        name
        entries {
          media {
            title {
              romaji
            }
            episodes
            coverImage {
              large
            }
            siteUrl
          }
          status  # Fetch the user's specific status for this anime
        }
      }
    }
  }
`;

        const variables = {
            userId: 154492 // Replace with your AniList user ID
        };

        try {
            const response = await fetch('https://graphql.anilist.co', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query: query,
                    variables: variables
                })
            });

            const result = await response.json();
            displayAnimeList(result.data.MediaListCollection.lists);
        } catch (error) {
            console.error('Error fetching the anime list:', error);
        }
    }

    function displayAnimeList(lists) {
    const animeListElement = document.getElementById('anime-list');
    animeListElement.innerHTML = ''; // Clear previous list

    lists.forEach(list => {
        list.entries.forEach(entry => {
            console.log(entry.media.title.romaji, entry.status); // Log the title and user-specific status

            const animeRow = document.createElement('tr');

            // Anime title and link
            const animeTitleCell = `<td><a href="${entry.media.siteUrl}" target="_blank">${entry.media.title.romaji}</a></td>`;
            
            // User-specific status text
            const statusTextCell = `<td>${entry.status}</td>`;
            
            // Number of episodes
            const episodesCell = `<td>${entry.media.episodes || "N/A"}</td>`;

            // Checkmark cells for statuses
            const statusCheckCell = (status) => `
                <td class="status-check">
                    <input type="checkbox" ${entry.status === status ? 'checked' : ''}>
                </td>
            `;

            // Create row with all the data
            animeRow.innerHTML = `
                ${animeTitleCell}
                ${statusTextCell}
                ${episodesCell}
                ${statusCheckCell('CURRENT')}
                ${statusCheckCell('COMPLETED')}
                ${statusCheckCell('PAUSED')}
                ${statusCheckCell('DROPPED')}
                ${statusCheckCell('PLANNING')}
            `;

            animeListElement.appendChild(animeRow);
        });
    });
}

    fetchAnimeList();
</script>

</body>
</html>